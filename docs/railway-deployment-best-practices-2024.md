# Railway ãƒ‡ãƒ—ãƒ­ã‚¤: Poetry vs requirements.txt ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ (2024å¹´)

## æ¦‚è¦

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€Railwayãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã® Python ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ãƒ—ãƒ­ã‚¤ã«ãŠã„ã¦ã€Poetry ã¨ requirements.txt ã®ã©ã¡ã‚‰ã‚’ä½¿ç”¨ã™ã¹ãã‹ã®èª¿æŸ»çµæœã‚’ã¾ã¨ã‚ãŸã‚‚ã®ã§ã™ã€‚è¤‡æ•°ã®æƒ…å ±æºï¼ˆContext7ã€Webæ¤œç´¢ã€ç¾åœ¨ã®ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹åˆ†æï¼‰ã‚’åŸºã«ã€2024å¹´ç¾åœ¨ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã‚’æä¾›ã—ã¾ã™ã€‚

## èª¿æŸ»çµæœ: æœ€çµ‚æ¨å¥¨

**çµè«–: requirements.txt ã‚’ä½¿ç”¨ã™ã¹ã**

## ç¾åœ¨ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆçŠ¶æ³

å½“ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯æ—¢ã«ç†æƒ³çš„ãªãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ§‹æˆã‚’å®Ÿè£…æ¸ˆã¿ï¼š
- **é–‹ç™ºç’°å¢ƒ**: Poetry (`pyproject.toml` + `poetry.lock`)
- **ãƒ‡ãƒ—ãƒ­ã‚¤ç’°å¢ƒ**: requirements.txt (`nixpacks-fallback.toml`)

## requirements.txt æ¨å¥¨ç†ç”±

### 1. ç¢ºå®Ÿæ€§ ğŸ¯
- **Poetry ã®ä¾å­˜é–¢ä¿‚è§£æ±ºã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå•é¡Œã‚’å›é¿**
  - Railwayç’°å¢ƒã§ "Resolving dependencies..." ã§åœæ­¢ã™ã‚‹æ—¢çŸ¥ã®å•é¡Œ
  - ç‰¹ã«è¤‡é›‘ãªä¾å­˜é–¢ä¿‚ã‚°ãƒ©ãƒ•ã§ç™ºç”Ÿ
  - Poetry 2.0ä»¥é™ã§å•é¡ŒãŒé¡•è‘—

### 2. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ âš¡
- **ãƒ“ãƒ«ãƒ‰æ™‚é–“ã®å¤§å¹…çŸ­ç¸®**
  - Nixpacks + Poetry: 87ç§’
  - requirements.txt: 15ç§’
  - pip install ã®å˜ç´”ã•ãŒé«˜é€ŸåŒ–ã«å¯„ä¸

### 3. Railway å…¬å¼ã‚µãƒãƒ¼ãƒˆ ğŸ“š
- **å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®å¤§éƒ¨åˆ†ãŒ requirements.txt ãƒ™ãƒ¼ã‚¹**
  - FastAPI ã‚¬ã‚¤ãƒ‰: requirements.txt ä½¿ç”¨
  - Flask ã‚¬ã‚¤ãƒ‰: `pip freeze > requirements.txt`
  - Django ã‚¬ã‚¤ãƒ‰: requirements.txt ã§ã®ä¾å­˜é–¢ä¿‚ç®¡ç†
- **Railway ã®æ¨™æº–çš„ãª Python ãƒ“ãƒ«ãƒ‰ãƒ‘ãƒƒã‚¯ãŒ pip/requirements.txt ã‚’æƒ³å®š**

### 4. æ¥­ç•Œæ¨™æº– ğŸŒ
- **2024å¹´ç¾åœ¨ã‚‚å¤šãã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§å¿…é ˆ**
  - Heroku: requirements.txt å¿…é ˆ
  - Streamlit: requirements.txt å¿…é ˆ
  - ãã®ä»–å¤šæ•°ã®PaaSãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ 
- **"Poetryé–‹ç™º â†’ requirements.txt ãƒ‡ãƒ—ãƒ­ã‚¤" ãŒæ¨å¥¨ãƒ‘ã‚¿ãƒ¼ãƒ³**

## å®Ÿè£…æ–¹æ³•

### ç¾åœ¨ã®æœ€é©è¨­å®šï¼ˆæ—¢ã«å®Ÿè£…æ¸ˆã¿ï¼‰

```toml
# nixpacks-fallback.toml (ãƒ¡ã‚¤ãƒ³ä½¿ç”¨æ¨å¥¨)
providers = ["python"]

[phases.install]
cmds = ["pip install -r requirements.txt"]

[start]
cmd = "uvicorn main:app --host 0.0.0.0 --port $PORT"
```

### ä¾å­˜é–¢ä¿‚æ›´æ–°ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

```bash
# Poetry ã§ä¾å­˜é–¢ä¿‚ã‚’ç®¡ç†
poetry add <package>
poetry update

# requirements.txt ã‚’æ›´æ–°ï¼ˆãƒ‡ãƒ—ãƒ­ã‚¤ç”¨ï¼‰
poetry export -f requirements.txt --output requirements.txt --without-hashes
```

## Poetry vs requirements.txt æ¯”è¼ƒè¡¨

| é …ç›® | Poetry | requirements.txt |
|------|--------|------------------|
| **é–‹ç™ºä½“é¨“** | âœ… å„ªç§€ï¼ˆä¾å­˜é–¢ä¿‚ç®¡ç†ã€ä»®æƒ³ç’°å¢ƒï¼‰ | âŒ åŸºæœ¬çš„ |
| **ãƒ‡ãƒ—ãƒ­ã‚¤ç¢ºå®Ÿæ€§** | âŒ ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãƒªã‚¹ã‚¯ | âœ… é«˜ã„ |
| **ãƒ“ãƒ«ãƒ‰é€Ÿåº¦** | âŒ é…ã„ï¼ˆ87ç§’ï¼‰ | âœ… é«˜é€Ÿï¼ˆ15ç§’ï¼‰ |
| **Railway ã‚µãƒãƒ¼ãƒˆ** | âš ï¸ é™å®šçš„ | âœ… å…¬å¼æ¨å¥¨ |
| **ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ äº’æ›æ€§** | âŒ é™å®šçš„ | âœ… åºƒç¯„å›² |
| **ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ€§** | âœ… lockãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç† | âš ï¸ æ‰‹å‹•æ›´æ–°å¿…è¦ |

## ãã®ä»–ã®èª¿æŸ»ãƒ‡ãƒ¼ã‚¿

### Poetry ã®å•é¡Œç‚¹ï¼ˆ2024å¹´ï¼‰

1. **ä¾å­˜é–¢ä¿‚è§£æ±ºã®è¤‡é›‘æ€§**
   - ã‚­ãƒ£ãƒ¬ãƒƒãƒˆè¨˜æ³•ï¼ˆ`^0.111.0`ï¼‰ã«ã‚ˆã‚‹å¤šæ•°ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³å€™è£œæ¤œè¨
   - PyPI ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®ä¸é©åˆ‡ãªå®£è¨€ã«ã‚ˆã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

2. **Railway ç‰¹æœ‰ã®å•é¡Œ**
   - Nixpacks ã§ã®Poetryã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒä¸å®‰å®š
   - Nix ã‚¬ãƒ™ãƒ¼ã‚¸ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã¨ã®ç«¶åˆ

3. **ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆäº‹ä¾‹**
   ```
   Resolving dependencies...
   Deploy failed
   ```

### requirements.txt ã®ãƒ¡ãƒªãƒƒãƒˆ

1. **ã‚·ãƒ³ãƒ—ãƒ«ã•**
   - ç›´æ¥çš„ãªä¾å­˜é–¢ä¿‚ãƒªã‚¹ãƒˆ
   - pip ã®æ¨™æº–çš„ãªå‹•ä½œ

2. **äºˆæ¸¬å¯èƒ½æ€§**
   - å›ºå®šãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚ˆã‚‹å†ç¾æ€§
   - ãƒ“ãƒ«ãƒ‰ç’°å¢ƒã§ã®ä¸€è²«æ€§

3. **ãƒ‡ãƒãƒƒã‚°ã®å®¹æ˜“ã•**
   - æ˜ç¤ºçš„ãªä¾å­˜é–¢ä¿‚
   - ã‚¨ãƒ©ãƒ¼ã®ç‰¹å®šãŒç°¡å˜

## æ¨å¥¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

### é–‹ç™ºç’°å¢ƒ
```bash
# Poetry ã§ä¾å­˜é–¢ä¿‚ç®¡ç†
poetry install
poetry add fastapi uvicorn
poetry run uvicorn main:app --reload
```

### ãƒ‡ãƒ—ãƒ­ã‚¤æº–å‚™
```bash
# requirements.txt æ›´æ–°
poetry export -f requirements.txt --output requirements.txt --without-hashes

# Git ã‚³ãƒŸãƒƒãƒˆ
git add requirements.txt pyproject.toml poetry.lock
git commit -m "Update dependencies"
```

### Railway ãƒ‡ãƒ—ãƒ­ã‚¤
- `nixpacks-fallback.toml` ãŒè‡ªå‹•çš„ã«ä½¿ç”¨ã•ã‚Œã‚‹
- requirements.txt ãƒ™ãƒ¼ã‚¹ã®é«˜é€Ÿãƒ‡ãƒ—ãƒ­ã‚¤ãŒå®Ÿè¡Œã•ã‚Œã‚‹

## ã¾ã¨ã‚

å½“ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯æ—¢ã«2024å¹´ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ï¼š

1. **é–‹ç™º**: Poetry ã§å„ªç§€ãªä¾å­˜é–¢ä¿‚ç®¡ç†
2. **ãƒ‡ãƒ—ãƒ­ã‚¤**: requirements.txt ã§ç¢ºå®Ÿã‹ã¤é«˜é€Ÿãªãƒ‡ãƒ—ãƒ­ã‚¤
3. **ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯**: ä¸¡æ–¹ã®è¨­å®šã‚’ç¶­æŒã—ã¦æŸ”è»Ÿæ€§ã‚’ç¢ºä¿

ã“ã®æ§‹æˆã«ã‚ˆã‚Šã€é–‹ç™ºåŠ¹ç‡ã¨ãƒ‡ãƒ—ãƒ­ã‚¤ã®å®‰å®šæ€§ã‚’ä¸¡ç«‹ã§ãã¦ã„ã¾ã™ã€‚

## å‚è€ƒè³‡æ–™

- [Railway å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.railway.com/)
- [Poetry å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://python-poetry.org/)
- [Python Packaging ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¬ã‚¤ãƒ‰](https://packaging.python.org/)
- [Railway Poetry ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¬ã‚¤ãƒ‰](./railway-poetry-deployment-troubleshooting.md)